#!/bin/bash

# Backup Configuration
BACKUP_SOURCE="/var/www/html"
BACKUP_DEST="/var/backups"
TIMESTAMP=$(date +"%Y%m%d_%H%M%S")
BACKUP_FILE="$BACKUP_DEST/website-backup-$TIMESTAMP.tar.gz"
LOG_FILE="/var/log/backup.log"

# Create backup directory if it doesn't exist
sudo mkdir -p $BACKUP_DEST
sudo chown $(whoami):$(whoami) $BACKUP_DEST /var/log/backup.log 2>/dev/null

# Create the backup
tar -czf "$BACKUP_FILE" -C "$(dirname "$BACKUP_SOURCE")" "$(basename "$BACKUP_SOURCE")"

# Check if the backup was successful and log it
if [ $? -eq 0 ]; then
  echo "$(date +"%Y-%m-%d %H:%M:%S") - SUCCESS: Backup of $BACKUP_SOURCE created at $BACKUP_FILE." >> $LOG_FILE
else
  echo "$(date +"%Y-%m-%d %H:%M:%S") - ERROR: Backup of $BACKUP_SOURCE failed." >> $LOG_FILE
fi
